<div class="relative inline-block">
  <!-- Avatar Container -->
  <div
    class="flex items-center justify-center text-white font-semibold relative overflow-hidden"
    [class]="sizeClasses"
    [class.rounded-full]="rounded"
    [class.rounded-lg]="!rounded"
    [ngClass]="hasAvatar ? 'bg-gray-200' : backgroundColor"
  >
    <!-- Profile Image -->
    <img
      *ngIf="hasAvatar"
      [src]="contact!.avatar"
      [alt]="contact?.name || 'Avatar'"
      class="w-full h-full object-cover"
      [class.rounded-full]="rounded"
      [class.rounded-lg]="!rounded"
      (error)="onImageError($event)"
    />

    <!-- Initials Fallback -->
    <span
      *ngIf="!hasAvatar"
      class="font-medium select-none"
      [attr.aria-label]="contact?.name || 'Unknown user'"
    >
      {{ initials }}
    </span>
  </div>

  <!-- Online Status Indicator -->
  <div
    *ngIf="showStatus"
    class="absolute -bottom-0.5 -right-0.5 border-2 border-white rounded-full"
    [class]="statusIndicatorSize"
    [class.bg-green-500]="isOnline"
    [class.bg-gray-400]="!isOnline"
    [attr.aria-label]="isOnline ? 'Online' : 'Offline'"
  ></div>

  <!-- Group Chat Indicator (optional) -->
  <div
    *ngIf="contact?.isGroup"
    class="absolute -top-1 -right-1 bg-blue-500 text-white rounded-full flex items-center justify-center text-xs font-bold"
    [class]="statusIndicatorSize"
    aria-label="Group chat"
  >
    <svg class="w-2 h-2" fill="currentColor" viewBox="0 0 20 20">
      <path
        d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 013.75-2.906z"
      />
    </svg>
  </div>
</div>
